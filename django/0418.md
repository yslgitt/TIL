# ğŸ¥ Django

## ì‹œì‘

```bash
python -m venv ê°€ìƒí™˜ê²½ì´ë¦„

source ê°€ìƒí™˜ê²½ì´ë¦„/Scripts/activate
```

```bash
pip install django==3.2.12
# pip install -r requirements.txt

# í”„ë¡œì íŠ¸ ìƒì„±: django-admin startproject í”„ë¡œì íŠ¸ì´ë¦„ .
django-admin startproject practice . # ì©œ! ìŠì§€ë§ê¸°!

# ë¡œì¼“ í™•ì¸
python manage.py runserver
# bash ì°½ ì›ìƒíƒœë¡œ ëŒë¦¬ê¸°: ctrl + c

# ì• í”Œë¦¬ì¼€ì´ì…˜
# python manage.py startapp ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë¦„
python manage.py startapp accounts
python manage.py startapp articles
```

```python
# ì•± ë“±ë¡
# í”„ë¡œì íŠ¸ í´ë” > settings.py

INSTALLED_APPS = [
    # ì´ê³³ì— ì•± ì´ë¦„ ì¶”ê°€ 
    'accounts', # < ì´ë ‡ê²Œ!
    'articles',  # < ì´ë ‡ê²Œ!
    
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
]

# templates
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates',], #ì´ë¶€ë¶„ ìˆ˜ì •
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]
```

```html
<!-- ê°€ì¥ ë°”ê¹¥ì— templates í´ë” ìƒì„± > base.html ìƒì„± -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
  <div class="container">
    {% block content %}

    {% endblock content %}
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>

</html>
```

```python
# í”„ë¡œì íŠ¸ í´ë” > urls.py
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('articles/', include('articles.urls')), #ì•± ì´ë¦„ 
    path('accounts/', include('accounts.urls')), #ì•± ì´ë¦„ 
]

```

```python
# ì•± í´ë” ì•ˆì— > urls.py ë§Œë“¤ê¸°

# articles
from django.urls import path
from . import views

app_name = 'articles'

urlpatterns = [

]

# accounts
from django.urls import path
from . import views

app_name = 'accounts'

urlpatterns = [

]
```



## models.py

```python
# accounts > models.py

from django.db import models
from django.contrib.auth.models import AbstractUser

# Create your models here.
class User(AbstractUser):
    followings = models.ManyToManyField('self', symmetrical=False, related_name='followers')
```

```python
# setting.py

AUTH_USER_MODEL = 'accounts.User' # ì¶”ê°€
```

```python
# accounts > forms.py ìƒì„±

from django.contrib.auth.forms import UserChangeForm, UserCreationForm
from django.contrib.auth import get_user_model

class CustomUserChangeForm(UserChangeForm):
    # password = None
    class Meta:
        model = get_user_model()
        fields = ('email', 'first_name', 'last_name',)

class CustomUserCreationForm(UserCreationForm):
    class Meta(UserCreationForm.Meta):
        model = get_user_model()
        fields = UserCreationForm.Meta.fields + ('email',)
```

```python
# accounts > admin.py

from django.contrib import admin
from django.contrib.auth.admin import UserAdmin
from .models import User

admin.site.register(User, UserAdmin)
```

```python
# articles > models.py

from django.db import models
from django.conf import settings

# Create your models here.
class Article(models.Model):
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    like_users = models.ManyToManyField(settings.AUTH_USER_MODEL, related_name='like_articles')
    title = models.CharField(max_length=10)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True) 
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self): # https://neung0.tistory.com/51
        return self.title


class Comment(models.Model):
    article = models.ForeignKey(Article, on_delete=models.CASCADE)
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    content = models.CharField(max_length=200)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return self.content
```

```python
# articles > forms.py ìƒì„±

from django import forms
from .models import Article, Comment

class ArticleForm(forms.ModelForm):
    class Meta:
        model = Article
        exclude = ('user', 'like_users',)

class CommentForm(forms.ModelForm):
    class Meta:
        model = Comment
        fields = ('content',)
```

```python
# articles > admin.py

from django.contrib import admin
from .models import Article, Comment

# Register your models here.
class ArticleAdmin(admin.ModelAdmin):
    list_display = ('pk', 'title', 'content', 'created_at', 'updated_at',)


admin.site.register(Article, ArticleAdmin)
admin.site.register(Comment)
```

```bash
# admin ê³„ì • ìƒì„±
python manage.py createsuperuser
```



- **AUTH_USER_MODEL**

  - Userë¥¼ ë‚˜íƒ€ë‚´ëŠ”ë° ì‚¬ìš©í•˜ëŠ” ëª¨ë¸
  - í”„ë¡œì íŠ¸ê°€ **ì§„í–‰ë˜ëŠ” ë™ì•ˆ ë³€ê²½í•  ìˆ˜ ì—†ìŒ** *(ì¤‘ê°„ì— ë³€ê²½í•˜ë ¤ë©´ ë§¤ìš° ë³µì¡)* > **ì´ˆê¸°ì— ì„¤ì •í•  ê²ƒ!*

- User ëª¨ë¸ ì°¸ì¡°í•˜ê¸°

  - settings.AUTH_USER_MODEL : models.py ì—ì„œ User ëª¨ë¸ì„ ì°¸ì¡°í•  ë•Œ ì‚¬ìš©

  - get_user_model() : models.pyê°€ ì•„ë‹Œ ë‹¤ë¥¸ ëª¨ë“  ê³³ì—ì„œ ìœ ì € ëª¨ë¸ì„ ì°¸ì¡°í•  ë•Œ ì‚¬ìš©

    

- ForeignKey : ë‘ê°œì˜ ìœ„ì¹˜ ì¸ìê°€ ë°˜ë“œì‹œ í•„ìš” (ì°¸ì¡°í•˜ëŠ” model class, on_delete ì˜µì…˜)

  - on delete - CASCADE (ë¶€ëª¨ ê°ì²´ê°€ ì‚­ì œ ë˜ì—ˆì„ ë•Œ ì´ë¥¼ ì°¸ì¡°í•˜ëŠ” ê°ì²´ë„ ì‚­ì œ)

- ManyToMany : í•˜ë‚˜ì˜ í•„ìˆ˜ ìœ„ì¹˜ì¸ì(M:N ê´€ê³„ë¡œ ì„¤ì •í•  ëª¨ë¸ í´ë˜ìŠ¤)ê°€ í•„ìš”

  - related_name : target modelì´ source modelì„ ì°¸ì¡°í•  ë•Œ(ì—­ì°¸ì¡° ì‹œ) ì‚¬ìš©í•  manager ì´ë¦„ ì„¤ì •

  - through

  - symmetrical

    - ìë™ ë§íŒ” > ì›ì¹˜ ì•Šì„ ê²½ìš° False ì„¤ì •

    

#### â• migrations

```bash
# models.py ë³€ê²½ì‚¬í•­ ë°œìƒì‹œ!

python manage.py makemigrations # migrations íŒŒì¼ ìƒì„±

python manage.py migrate # DB ë°˜ì˜

#db.sqlite3 ìš°í´ë¦­ open database
```



## accounts, articles

#### ğŸ”¹ articles : index, create, detail

```python
# articles > urls.py

from django.urls import path
from . import views

app_name = 'articles'

urlpatterns = [
    path('', views.index, name='index'),
    path('create/', views.create, name='create'),
    path('<int:pk>/', views.detail, name='detail'),
]
```

```python
# articles > views.py
# ì•„ì§ ëŒ“ê¸€ êµ¬í˜„ x, ë°ì½”ë ˆì´í„° x

from django.shortcuts import get_object_or_404, redirect, render
from articles.forms import ArticleForm
from .models import Article

# Create your views here.

def index(request):
    articles = Article.objects.order_by('-pk')
    context = {
        'articles' : articles,
    }
    return render(request, 'articles/index.html', context)

def create(request):
    if request.method == 'POST':
        form = ArticleForm(request.POST)
        if form.is_valid(): # is_vaild : ìœ íš¨ì„± ê²€ì‚¬
            article = form.save(commit=False) # commit=False : ë‹¹ì¥ ì €ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤
            article.user = request.user
            article.save()
            return redirect('articles:detail', article.pk)
    else:
        form = ArticleForm()
    context = {
        'form' : form,
    }
    return render(request, 'articles/create.html', context)

def detail(request, pk):
    article = get_object_or_404(Article, pk=pk)
    context = {
        'article' : article,
    }
    return render(request, 'articles/detail.html', context)

```

